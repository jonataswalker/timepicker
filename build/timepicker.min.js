/**
 * A lightweight, customizable, TimePicker. Zero dependencies.
 * https://github.com/jonataswalker/timepicker.js
 * Version: v2.0.1
 * Built: 2016-10-01T17:05:48+02:00
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.TimePicker=t()}(this,function(){"use strict";var e={open:"open",close:"close",change:"change",start_fade_in:"start-fade-in",end_fade_in:"end-fade-in",start_fade_out:"start-fade-out",end_fade_out:"end-fade-out"},t={lang:"en",theme:"dark"},n={en:{hour:"Hour",minute:"Minute"},pt:{hour:"Hora",minute:"Minuto"}},i={focusable:/^(?:input|select|textarea|button|object)$/i,clickable:/^(?:a|area)$/i,classRegex:function(e){return new RegExp("(^|\\s+) "+e+" (\\s+|$)")},addClass:function(e,t,n){var i=this;if(Array.isArray(e))return void e.forEach(function(e){i.addClass(e,t)});for(var s=Array.isArray(t)?t:t.split(/\s+/),r=s.length;r--;)i.hasClass(e,s[r])||i._addClass(e,s[r],n)},_addClass:function(e,t,n){var i=this;e.classList?e.classList.add(t):e.className=(e.className+" "+t).trim(),n&&this.isNumeric(n)&&window.setTimeout(function(){i._removeClass(e,t)},n)},removeClass:function(e,t,n){var i=this;if(Array.isArray(e))return void e.forEach(function(e){i.removeClass(e,t,n)});for(var s=Array.isArray(t)?t:t.split(/\s+/),r=s.length;r--;)i.hasClass(e,s[r])&&i._removeClass(e,s[r],n)},_removeClass:function(e,t,n){var i=this;e.classList?e.classList.remove(t):e.className=e.className.replace(this.classRegex(t)," ").trim(),n&&this.isNumeric(n)&&window.setTimeout(function(){i._addClass(e,t)},n)},hasClass:function(e,t){return e.classList?e.classList.contains(t):this.classRegex(t).test(e.className)},toggleClass:function(e,t){var n=this;return Array.isArray(e)?void e.forEach(function(e){n.toggleClass(e,t)}):void(e.classList?e.classList.toggle(t):this.hasClass(e,t)?this._removeClass(e,t):this._addClass(e,t))},$:function(e){return e="#"===e[0]?e.substr(1,e.length):e,document.getElementById(e)},isElement:function(e){return"HTMLElement"in window?!!e&&e instanceof HTMLElement:!!e&&"object"==typeof e&&1===e.nodeType&&!!e.nodeName},getAllChildren:function(e,t){return[].slice.call(e.getElementsByTagName(t))},getMaxZIndex:function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=-1);for(var i=this.find("*",document,!0),s=i.length;++n<s;)e=parseInt(window.getComputedStyle(i[n]).zIndex,10),t=e?Math.max(t,e):t;return t},mergeOptions:function(e,t){var n={};for(var i in e)n[i]=e[i];for(var s in t)n[s]=t[s];return n},createElement:function(e,t){var n;if(Array.isArray(e)){if(n=document.createElement(e[0]),e[1].id&&(n.id=e[1].id),e[1].classname&&(n.className=e[1].classname),e[1].attr){var i=e[1].attr;if(Array.isArray(i))for(var s=-1;++s<i.length;)n.setAttribute(i[s].name,i[s].value);else n.setAttribute(i.name,i.value)}}else n=document.createElement(e);n.innerHTML=t;for(var r=document.createDocumentFragment();n.childNodes[0];)r.appendChild(n.childNodes[0]);return n.appendChild(r),n},find:function(e,t,n){var i=/^(#?[\w-]+|\.[\w-.]+)$/,s=/\./g,r=[].slice,o=[];if(i.test(e))switch(e[0]){case"#":o=[this.$(e.substr(1))];break;case".":o=r.call(t.getElementsByClassName(e.substr(1).replace(s," ")));break;default:o=r.call(t.getElementsByTagName(e))}else o=r.call(t.querySelectorAll(e));return n?o:o[0]},offset:function(e){var t=e.getBoundingClientRect(),n=document.documentElement;return{left:t.left+window.pageXOffset-n.clientLeft,top:t.top+window.pageYOffset-n.clientTop,width:e.offsetWidth,height:e.offsetHeight}},getWindowSize:function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}},evaluate:function(e){var t;switch(this.toType(e)){case"window":case"htmldocument":case"element":t=e;break;case"string":t=this.$(e)}return this.assert(t,"Can't evaluate: @param "+e),t},toType:function(e){return e==window&&e.document&&e.location?"window":e==document?"htmldocument":"string"==typeof e?"string":this.isElement(e)?"element":void 0},typeOf:function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},events:function(){var e={},t=e.hasOwnProperty;return{subscribe:function(n,i){t.call(e,n)||(e[n]=[]);var s=e[n].push(i)-1;return{remove:function(){delete e[n][s]}}},publish:function(n,i){t.call(e,n)&&e[n].forEach(function(e){e(void 0!==i?i:{})})}}},fade:function(t,n,i,s){void 0===i&&(i=300),void 0===s&&(s="in");var r,o,a=null,l=!1,c="in"==s?e.start_fade_in:e.start_fade_out,u="in"==s?e.end_fade_in:e.end_fade_out,h=function(e){a||(t.publish(c,{target:n}),a=e),"in"==s?(r=+n.style.opacity+(e-a)/i,l=r>=1):(r=+n.style.opacity-(e-a)/i,l=r<=0),n.style.opacity=r,l?t.publish(u,{target:n}):o=window.requestAnimationFrame(h)};return o=window.requestAnimationFrame(h)},assert:function(e,t){if(!e){if(t=t||"Assertion failed","undefined"!=typeof Error)throw new Error(t);throw t}}},s="_jw-tpk",r="-container",o="-header",a="-body",l="-hour",c="-minute",u="-selected",h="-dragging",d={hour:"data-hour",minute:"data-minute"},f={hour_list:"hour_list_id",minute_list:"minute_list_id"},m=function(e){this.Base=e};m.prototype.createPicker=function(){for(var e,t,a=this.Base.options,l=m.picker.indexOf(m.replace.hour_list),c=m.picker.indexOf(m.replace.minute_list),u=m.picker.indexOf(m.replace.hour_title),h=m.picker.indexOf(m.replace.minute_title),f=[],p=[],v=0,g=6,_=0;_<4;_++){for(t=v+g,f.push("<ol>");v<t;v++)f.push(["<li><a ",d.hour,'="',v,'">',v,"</a></li>"].join(""));f.push("</ol>")}for(v=0,t=0,g=15,_=0;_<4;_++){for(t=v+g,p.push("<ol>");v<t;v+=5)e=v<10?e="0"+v:v,p.push(["<li><a ",d.minute,'="',e,'">',e,"</a></li>"].join(""));p.push("</ol>")}m.picker[l]=f.join(""),m.picker[c]=p.join(""),m.picker[u]=n[a.lang].hour,m.picker[h]=n[a.lang].minute;var y=i.createElement(["div",{classname:s+r+" "+s+"-"+a.theme}],m.picker.join(""));y.style.zIndex=i.getMaxZIndex()+10,y.style.visibility="hidden",document.body.appendChild(y);var w=i.offset(y);return this.Base.container={size:{width:w.width,height:w.height},element:y,drag_handle:y.querySelector("."+(s+o))},y.style.visibility="",y.style.display="none",y},m.replace={hour_list:"__hour-list__",minute_list:"__minute-list__",hour_title:"__hour-title__",minute_title:"__minute-title__"},m.picker=['<div class="'+(s+o)+'">','<div class="'+(s+l)+'">',m.replace.hour_title,"</div>",'<div class="'+(s+c)+'">',m.replace.minute_title,"</div>","</div>",'<div class="'+(s+a)+'">','<div id="'+f.hour_list+'" class="'+(s+l)+'">',m.replace.hour_list,"</div>",'<div id="'+f.minute_list+'" class="'+(s+c)+'">',m.replace.minute_list,"</div>","</div>"];var p=function(e){var t,n,i,s,r,o,a=e.container.element,l={},c=function(e){e.preventDefault&&e.preventDefault(),i=parseInt(a.style.left,10)||0,s=parseInt(a.style.top,10)||0,r=i+(e.clientX-t),o=s+(e.clientY-n),l.move.call(void 0,{target:a,x:r,y:o}),t=e.clientX,n=e.clientY},u=function(){document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",stop,!1),l.end.call(void 0,{target:a,x:r,y:o})},h=function(e){0===e.button&&(t=e.clientX,n=e.clientY,l.start.call({target:a}),document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",u,!1))};return e.container.drag_handle.addEventListener("mousedown",h,!1),{when:function(e){l.start=e.start,l.move=e.move,l.end=e.end}}},v=function(e){this.Base=e,this.container=e.container.element,this.closeWhen={hour:!1,minute:!1},this._ids=0,this.id_active=void 0,this.opened=!1,this.targets=[],this.collection={hours:[],minutes:[]},this.events=i.events(),this.request_ani_id=void 0};v.prototype.init=function(){this.setFocusListener(this.Base.target),this.setSelectListener()},v.prototype.show=function(t){var n=this.targets[t].element,s=i.offset(n),r=this.Base.container.size,o=s.top+s.height+5,a=i.getWindowSize();s.left+r.width>a.width?(this.container.style.left="",this.container.style.right="5px"):(this.container.style.right="",this.container.style.left=s.left+"px"),s.top+r.height>a.height?this.container.style.bottom="5px":this.container.style.top=o+"px",this.events.subscribe(e.start_fade_in,function(e){e.target.style.opacity=0,e.target.style.display="block"}),this.request_ani_id=i.fade(this.events,this.container,400),this.Base.dispatchEvent(e.open,{element:n}),this.handleOpen(t)},v.prototype.show_=function(){var e=this;this.targets.forEach(function(t){e.show(t.element._id)})},v.prototype.hide=function(t){this.opened=!1,this.events.subscribe(e.start_fade_out,function(e){e.target.style.opacity=1,e.target.style.display="block"}),this.events.subscribe(e.end_fade_out,function(e){e.target.style.display="none"}),this.request_ani_id=i.fade(this.events,this.container,800,"out"),this.Base.dispatchEvent(e.close,{element:this.targets[t].element})},v.prototype.hide_=function(){var e=this;this.targets.forEach(function(t){e.hide(t.element._id)})},v.prototype.handleOpen=function(e){var t,n=this,r=this,o=s+u,a=this.targets[e].hour,l=this.targets[e].minute;i.removeClass(this.collection.hours,o),i.removeClass(this.collection.minutes,o),a&&l&&(this.collection.hours.forEach(function(e){if(t=n.getHour(e),t==a)return void i.addClass(e,o)}),this.collection.minutes.forEach(function(e){if(t=n.getMinute(e),t==l)return void i.addClass(e,o)})),document.addEventListener("mousedown",{handleEvent:function(t){if(!r.container.contains(t.target)){var n=!1;r.targets.forEach(function(e){e.element==t.target&&(n=!0)}),!n&&r.opened&&r.hide(),r.targets[e].element!=t.target&&document.removeEventListener(t.type,this,!1)}}},!1),this.opened=!0,this.id_active=e,this.closeWhen={hour:!1,minute:!1}},v.prototype.handleClose=function(e){this.closeWhen.hour&&this.closeWhen.minute&&this.hide(e)},v.prototype.getHour=function(e){return e.getAttribute(d.hour)},v.prototype.getMinute=function(e){return e.getAttribute(d.minute)},v.prototype.setSelectListener=function(){var t=this,n=i.$(f.hour_list),r=i.$(f.minute_list),o=s+u;this.collection.hours=i.getAllChildren(n,"a"),this.collection.minutes=i.getAllChildren(r,"a");var a=function(n){n.preventDefault();var s=t.targets[t.id_active];s.hour=t.getHour(n.target),t.Base.dispatchEvent(e.change,{element:s.element,hour:s.hour,minute:s.minute}),i.removeClass(t.collection.hours,o),i.addClass(n.target,o),t.closeWhen.hour=!0,t.handleClose(t.id_active)},l=function(n){n.preventDefault();var s=t.targets[t.id_active];s.minute=t.getMinute(n.target),t.Base.dispatchEvent(e.change,{element:s.element,hour:s.hour,minute:s.minute}),i.removeClass(t.collection.minutes,o),i.addClass(n.target,o),t.closeWhen.minute=!0,t.handleClose(t.id_active)};this.collection.hours.forEach(function(e){e.addEventListener("click",a)}),this.collection.minutes.forEach(function(e){e.addEventListener("click",l)})},v.prototype.setFocusListener=function(e){var t,n=this,s=function(e){e.preventDefault(),window.cancelAnimationFrame(n.request_ani_id),n.show(e.target._id)},r=[];e=Array.isArray(e)?e:[e],Array.prototype.push.apply(r,e),r.forEach(function(e){if(t=i.evaluate(e)){var r=n._ids++;t._id=r,n.targets[r]={element:t},i.focusable.test(t.nodeName)?t.addEventListener("focus",s,!0):i.clickable.test(t.nodeName)&&t.addEventListener("click",s,!0)}})};var g=function(){this._events=this._events||{},this._onceEvents=this._onceEvents||{}};g.prototype.on=function(e,t){if(e&&t){var n=this._events[e]=this._events[e]||[];return n.indexOf(t)==-1&&n.push(t),this}},g.prototype.once=function(e,t){if(e&&t){this.on(e,t);var n=this._onceEvents[e]=this._onceEvents[e]||{};return n[t]=!0,this}},g.prototype.off=function(e,t){var n=this._events&&this._events[e];if(n&&n.length){var i=n.indexOf(t);return i!=-1&&n.splice(i,1),this}},g.prototype.dispatchEvent=function(e,t){var n=this;void 0===t&&(t={});var i=this._events&&this._events[e];if(i&&i.length){for(var s=0,r=i[s],o=this._onceEvents&&this._onceEvents[e];r;){var a=o&&o[r];a&&(n.off(e,r),delete o[r]),r.call(n,t),s+=a?0:1,r=i[s]}return this}};var _=function(e){function n(r,o){void 0===o&&(o={}),i.assert(Array.isArray(r)||"string"==i.typeOf(r)||i.isElement(r),"`target` should be Element, <Array>Element, String or <Array>String."),e.call(this),this.options=i.mergeOptions(t,o),this.target=r,this.container={};var a=new m(this),l=a.createPicker(),c=new p(this);n.Internal=new v(this),n.Internal.init(),c.when({start:function(){i.addClass(l,s+h)},move:function(e){l.style.left=e.x+"px",l.style.top=e.y+"px"},end:function(e){i.removeClass(l,s+h),e.y<0&&(l.style.top=0)}})}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.show=function(){n.Internal.show_()},n.prototype.hide=function(){n.Internal.hide_()},n.prototype.setTarget=function(e){i.assert(Array.isArray(e)||"string"==i.typeOf(e)||i.isElement(e),"`target` should be Element, <Array>Element, String or <Array>String."),this.target=e,n.Internal.setFocusListener(this.target)},n}(g);return _});
